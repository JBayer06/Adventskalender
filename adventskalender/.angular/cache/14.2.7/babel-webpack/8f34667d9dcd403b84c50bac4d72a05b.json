{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"../../_services/remote.service\";\nimport * as i2 from \"../../_services/authentication.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/router\";\n\nfunction ScoresComponent_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 3);\n  }\n}\n\nfunction ScoresComponent_div_4_li_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"li\", 13)(1, \"a\", 14);\n    i0.ɵɵlistener(\"click\", function ScoresComponent_div_4_li_2_Template_a_click_1_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r8);\n      const v_r6 = restoredCtx.$implicit;\n      const ctx_r7 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r7.view(v_r6));\n    });\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const v_r6 = ctx.$implicit;\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵclassProp(\"active\", ctx_r2.currentView.id == v_r6.id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(v_r6.name);\n  }\n}\n\nfunction ScoresComponent_div_4_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 15);\n    i0.ɵɵtext(1, \" Du bist auf \");\n    i0.ɵɵelementStart(2, \"b\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(4);\n    i0.ɵɵelementStart(5, \"i\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(7, \". \");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"Platz \", ctx_r3.myPlace, \"\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" von \", ctx_r3.placesCount, \" in der Kategorie \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r3.currentView.name);\n  }\n}\n\nfunction ScoresComponent_div_4_th_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 9);\n    i0.ɵɵtext(1, \"Benutzer\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction ScoresComponent_div_4_tr_16_td_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const user_r9 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(user_r9.nickname);\n  }\n}\n\nfunction ScoresComponent_div_4_tr_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, ScoresComponent_div_4_tr_16_td_3_Template, 2, 1, \"td\", 2);\n    i0.ɵɵelementStart(4, \"td\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"td\")(9, \"div\", 16);\n    i0.ɵɵelement(10, \"div\", 17);\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const user_r9 = ctx.$implicit;\n    const ctx_r5 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(user_r9.place);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r5.currentView.id != \"grades-absolute\" && ctx_r5.currentView.id != \"grades-relative\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(user_r9.grade);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(user_r9.points);\n    i0.ɵɵadvance(3);\n    i0.ɵɵstyleProp(\"width\", user_r9.points / ctx_r5.maxPoints * 100 + \"%\");\n  }\n}\n\nfunction ScoresComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"ul\", 4);\n    i0.ɵɵtemplate(2, ScoresComponent_div_4_li_2_Template, 3, 3, \"li\", 5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, ScoresComponent_div_4_div_3_Template, 8, 3, \"div\", 6);\n    i0.ɵɵelementStart(4, \"div\", 7)(5, \"table\", 8)(6, \"thead\")(7, \"tr\")(8, \"th\", 9);\n    i0.ɵɵtext(9, \"Platz\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(10, ScoresComponent_div_4_th_10_Template, 2, 0, \"th\", 10);\n    i0.ɵɵelementStart(11, \"th\", 9);\n    i0.ɵɵtext(12, \"Klasse\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"th\", 11);\n    i0.ɵɵtext(14, \"Punkte\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(15, \"tbody\");\n    i0.ɵɵtemplate(16, ScoresComponent_div_4_tr_16_Template, 11, 6, \"tr\", 12);\n    i0.ɵɵelementEnd()()()();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.views);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.authenticationService.currentUser && ctx_r1.myPlace);\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.currentView.id != \"grades-absolute\" && ctx_r1.currentView.id != \"grades-relative\");\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.users);\n  }\n}\n\nexport let ScoresComponent = /*#__PURE__*/(() => {\n  class ScoresComponent {\n    constructor(remoteService, authenticationService) {\n      this.remoteService = remoteService;\n      this.authenticationService = authenticationService;\n      this.users = [];\n      this.allUsers = [];\n      this.maxPoints = 1000000000;\n      this.loading = true;\n      this.views = [{\n        id: \"all\",\n        name: \"Alle\"\n      }, {\n        id: \"students\",\n        name: \"Schüler\"\n      }, {\n        id: \"formerStudents\",\n        name: \"Ehemalige Schüler\"\n      }, {\n        id: \"teachers\",\n        name: \"Lehrer\"\n      }, {\n        id: \"parents\",\n        name: \"Eltern\"\n      }, {\n        id: \"grades-absolute\",\n        name: \"Klassen (absolut)\"\n      }, {\n        id: \"grades-relative\",\n        name: \"Klassen (relativ)\"\n      }];\n      this.currentView = this.views[0];\n    }\n\n    ngOnInit() {\n      this.remoteService.get(\"users\").subscribe(data => {\n        if (data) {\n          this.loading = false;\n          this.allUsers = data;\n          this.filterAndDisplayData();\n        }\n      });\n    }\n\n    filterAndDisplayData() {\n      var _a, _b;\n\n      if (this.currentView.id == \"all\") {\n        this.users = this.allUsers;\n      } else if (this.currentView.id == \"students\") {\n        this.users = this.allUsers.filter(u => u.grade.length < 4);\n      } else if (this.currentView.id == \"formerStudents\") {\n        this.users = this.allUsers.filter(u => u.grade == \"Ehemalige Schülerin oder Schüler\");\n      } else if (this.currentView.id == \"parents\") {\n        this.users = this.allUsers.filter(u => u.grade == \"Eltern\");\n      } else if (this.currentView.id == \"teachers\") {\n        this.users = this.allUsers.filter(u => u.grade === \"Lehrerin / Lehrer\" || u.grade.startsWith(\"Studienseminar\"));\n      } else if (this.currentView.id == \"grades-relative\" || this.currentView.id == \"grades-absolute\") {\n        const grades = {};\n\n        for (const user of this.allUsers) {\n          if (!grades[user.grade]) {\n            grades[user.grade] = {\n              points: 0,\n              users: 0\n            };\n          }\n\n          grades[user.grade].points += user.points;\n          grades[user.grade].users++;\n        }\n\n        this.users = [];\n\n        for (const [grade, d] of Object.entries(grades)) {\n          this.users.push({\n            grade,\n            points: this.currentView.id == \"grades-absolute\" ? d.points : Math.round(d.points / d.users)\n          });\n        }\n      }\n\n      this.users.sort((a, b) => b.points - a.points);\n      this.maxPoints = 1000000000;\n      let place = 1;\n      let lastUser;\n\n      for (const user of this.users) {\n        if ((lastUser === null || lastUser === void 0 ? void 0 : lastUser.points) && user.points < lastUser.points) {\n          place++;\n        }\n\n        user.place = place;\n        lastUser = user;\n      }\n\n      if (this.authenticationService.currentUser) {\n        if (this.currentView.id == \"grades-absolute\" || this.currentView.id == \"grades-relative\") {\n          this.myPlace = (_a = this.users.filter(u => u.grade == this.authenticationService.currentUser.grade)[0]) === null || _a === void 0 ? void 0 : _a.place;\n        } else {\n          const user = this.users.filter(u => u.nickname == this.authenticationService.currentUser.nickname);\n\n          if (user && user[0]) {\n            this.myPlace = user[0].place;\n          } else {\n            this.myPlace = undefined;\n          }\n        }\n\n        this.placesCount = (_b = this.users[this.users.length - 1]) === null || _b === void 0 ? void 0 : _b.place;\n      }\n\n      setTimeout(() => {\n        if (this.users.length) {\n          this.maxPoints = this.users.reduce((p, c) => p.points > c.points ? p : c).points;\n        }\n      }, 20);\n    }\n\n    view(v) {\n      this.currentView = v;\n      this.filterAndDisplayData();\n    }\n\n  }\n\n  ScoresComponent.ɵfac = function ScoresComponent_Factory(t) {\n    return new (t || ScoresComponent)(i0.ɵɵdirectiveInject(i1.RemoteService), i0.ɵɵdirectiveInject(i2.AuthenticationService));\n  };\n\n  ScoresComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ScoresComponent,\n    selectors: [[\"app-scores\"]],\n    decls: 5,\n    vars: 2,\n    consts: [[1, \"text-center\", \"mb-3\"], [\"class\", \"spinner-border text-primary mt-5 mx-auto\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"spinner-border\", \"text-primary\", \"mt-5\", \"mx-auto\"], [1, \"nav\", \"nav-tabs\"], [\"class\", \"nav-item\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"alert alert-success my-3\", 4, \"ngIf\"], [1, \"table-responsive\", \"mt-1\"], [1, \"table\", \"table-striped\", \"border-top-0\", \"bg-light\"], [1, \"border-top-0\"], [\"class\", \"border-top-0\", 4, \"ngIf\"], [\"colspan\", \"2\", 1, \"border-top-0\"], [4, \"ngFor\", \"ngForOf\"], [1, \"nav-item\"], [1, \"nav-link\", 3, \"routerLink\", \"click\"], [1, \"alert\", \"alert-success\", \"my-3\"], [1, \"progress\", \"pointsIndicator\"], [\"role\", \"progressbar\", 1, \"progress-bar\"]],\n    template: function ScoresComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"h3\");\n        i0.ɵɵtext(2, \"Bestenliste\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵtemplate(3, ScoresComponent_div_3_Template, 1, 0, \"div\", 1);\n        i0.ɵɵtemplate(4, ScoresComponent_div_4_Template, 17, 4, \"div\", 2);\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngIf\", ctx.loading);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.loading);\n      }\n    },\n    dependencies: [i3.NgForOf, i3.NgIf, i4.RouterLinkWithHref]\n  });\n  return ScoresComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}